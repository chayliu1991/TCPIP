# 应用层协议概要  

- 应用协议的定义

利用网络的应用程序有很多， 包括Web 浏览器、 电子邮件、 远程登录、 文件传输、 网络管理等。 能够让这些应用进行特定通信处理的正是应用协议。  

- 应用协议与协议的分层  

网络应用由不同的用户和软件供应商开发而成。 为了实现网络应用的功能， 在应用之间进行通信时将其连接的网络协议是非常重要的应用之间交互的信息叫消息。 应用协议定义这些消息的格式以及使用这些消息进行控制或操作的规则。 ） 。 设计师和开发人员根据所开发模块的功能和目的， 可以利用现有的应用协
议， 也可以自己定义一个新的应用协议。    

- 相当于OSI中第5、 第6、 第7层的协议  

TCP/IP的应用层涵盖了OSI参考模型中第5、 第6、 第7层的所有功能， 不仅包含了管理通信连接的会话层功能、 转换数据格式的表示层功能， 还包括与对端主机交互的应用层功能在内的所有功能。  

# 远程登录  

远程登录是为了实现TSS（TSS（Time Sharing System） 分时系统。）  环境， 是将主机和终端的关系应用到计算机网络上的一个结果。 TSS中通常有一个处理能力非常强的主机，围绕着这台主机的是处理能力没有那么强的多个终端机器。 这些终端通过专线与主机相连。   

类似地， 实现从自己的本地计算机登录到网络另一端计算功能的应用就叫做远程登录。 通过远程登录到通用计算机或UNIX工作站以后， 不仅可以直接使用这些主机上的应用， 还可以对这些计算机进行参数设置。 远程登录主要使用TELNET和SSH（Secure SHell。 ） 两种协议。  

## TELNET  

TELNET利用TCP的一条连接， 通过这一条连接向主机发送文字命令并在主机上执行。 本地用户好像直接与远端主机内部的 Shell 相连着似的， 直接在本地进行操作。   

TELNET可以分为两类基本服务。 一是仿真终端功能， 二是协商选项机制。  

![](./img/telnet.png)

TELNET经常用于登录路由器或高性能交换机等网络设备进行相应的设置。 通过TELNET登录主机或路由器等设备时需要将自己的登录用户名和密码注册到
服务端。  

### 选项

TELNET中除了处理用户所输入的文字外， 还提供选项的交互和协商功能。   

![](./img/telnet_mode.png)

### TELNET客户端  

所谓TELNET客户端是指利用TELNET协议实现远程登录的客户端程序。 很多情况下， 它的程序名就是telnet命令。  

TELNET客户端通常与目标主机的23号端口建立连接， 并与监听这个端口的服务端程序telnetd进行交互。 当然， 也可以与其他的TCP端口号连接， 只要在该端口上有监听程序能够处理telnet请求即可。  

## SSH  

SSH是加密的远程登录系统。 TELNET中登录时无需输入密码就可以发送， 容易造成通信窃听和非法入侵的危险。 使用SSH后可以加密通信内容。 即使信息被窃听也无法破解所发送的密码、 具体命令以及命令返回的结果是什么。  

SSH还包括很多非常方便的功能：

- 可以使用更强的认证机制
- 可以转发文件（UNIX中可以使用scp、 sftp等命令。 ） 
- 可以使用端口转发功能（可以通过X Window System串口展现。 ）

端口转发是指将特定端口号所收到的消息转发到特定的IP地址和端口号码的一种机制。 由于经过SSH连接的那部分内容被加密， 确保了信息安全， 提供了更为灵活的通信（可以实现虚拟专用网（VPN， Virtual Private Network） 。 ）   。  

![](./img/ssh.png)



# 文件传输  

FTP是在两个相连的计算机之间进行文件传输时使用的协议。FTP中也需要在登录到对方的计算机后才能进行相应的操作。互联网上有一种FTP服务器是允许任何人进行访问的， 这种服务器叫做匿名服务器（anonymous ftp） 。登录这些服务器时使用匿名（anonymous） 或ftp都可以 。

## FTP的工作机制概要  

FTP使用两条TCP连接： 一条用来控制， 另一条用于数据（文件） 的传输。  

用于控制的TCP连接主要在FTP的控制部分使用。 例如登录用户名和密码的验证、 发送文件的名称、 发送方式的设置。 利用这个连接， 可以通过ASCII码字符串发送请求和接收应答。 在这个连接上无法发送数据， 数据需要一个专门的TCP进行连接。  

FTP控制用的连接使用的是TCP21号端口。 在TCP21号端口上进行文件GET（RETR） 、PUT（STOR） 、 以及文件一览（LIST） 等操作时， 每次都会建立一个用于数据传输的TCP连接。 数据的传输和文件一览表的传输正是在这个新建的连接上进行。 当数据传送完毕之后， 传输数据的这条连接也会被断开， 然后会在控制用的连接上继续进行命令或应答的处理。  

通常， 用于数据传输的TCP连接是按照与控制用的连接相反的方向建立的。 因此， 在通过NAT连接外部FTP服务器的时候， 无法直接建立传输数据时使用的TCP连接。 此时， 必须使用PASV命令修改建立连接的方向才行。  

控制用的连接， 在用户要求断开之前会一直保持连接状态。 不过， 绝大多数FTP服务器都会对长时间没有任何新命令输入的用户的连接强制断开。

数据传输用的TCP连接通常使用端口20。 不过可以用PORT命令修改为其他的值。 最近， 出于安全的考虑， 普遍在数据传输用的端口号中使用随机数进行分配。  

![](./img/ftp.png)

## 通过ASCII码字符串进行的交互处理  

FTP中请求命令中使用着“RETR”等ASCII（American Standard Code for Information Interchange的省略。 ） 码字符串。 而针对这些命令的应答则使用如“200”等3位数字的ASCII码字符串。 TCP/IP的应用协议中有很多使用这种ASCII码字符串的协议。  

对于ASCII码字符串型的协议来说换行具有重要意义。 很多情况下， 一行字符串表示一个命令或一个应答， 而空白则用来标识与参数之间的分割符。 即， 命令和应答的消息通过换行区分、 参数用空格区分。 换行由“CR”（ASCII码的十进制数为13） 和“LF”（ASCII码的十进制数为10） 两个控制符号组成。  

## FTP主要的命令和应答信息  

FTP 主要命令：

![](./img/ftp_command.png)

FTP 应答信息：

![](./img/ftp_response.png)

![](./img/ftp_response2.png)

# 电子邮件  

![](./img/email.png)

## 电子邮件的工作机制  

提供电子邮件服务的协议叫做SMTP（Simple Mail Transfer Protocol） 。 SMTP为了实现高效发送邮件内容， 在其传输层使用了TCP协议。  

早期电子邮件是在发送端主机与接收端主机之间直接建立TCP连接进行邮件传输。这种方法， 在提高电子邮件的可靠性传输上非常有效。 但是， 互联网应用逐渐变得越发复杂， 这种机制也将无法正常工作。 例如， 使用者的计算机时而关机时而开机的情况下， 只有发送端和接收端都处于插电并且开机的状态时才可能实现电子邮件的收发。     

![](./img/early_email.png)

为此， 在技术上改变了以往直接在发送端与接收端主机之间建立TCP连接的机制， 而引进了一种一直会连接电源的邮件服务器。 发送和接收端通过邮件服务器进行收发邮件。 接收端从邮件服务器接收邮件时使用POP3（Post Office Protocol） 协议。    

![](./img/modern_email.png)

电子邮件的机制由3部分组成， 它们分别是邮件地址， 数据格式以及发送协议。  

## 邮件地址  

使用电子邮件时需要拥有的地址叫做邮件地址。 它就相当于通信地址和姓名。 互联网中电子邮件地址的格式如下：名称@通信地址。  

 ## MIME  

电子邮件所能发送的数据类型已被扩展到MIME（Multipurpose Internet Mail Extensions， 广泛用于互联网并极大地扩展了数据格式， 还可以用于WWW和NetNews中。 ） ， 可以发送静态图像、 动画、 声音、 程序等各种形式的数据。      

MIME基本上由首部和正文（数据） 两部分组成。 首部不能是空行， 因为一旦出现空行， 其后的部分将被视为正文（数据） 。 如果MIME首部的“Content-Type”中指定“Multipart/Mixed”， 并以“boundary=”后面字符作为分隔符（boundary=后面的字符串， 开头一定要写- -。 而且， 间隔符后面也一定要写- -。 ） ， 那么可以将多个MIME消息组合成为一个MIME消息。 这就叫做multipart。 即， 各个部分都由MIME首部和正文（数据） 组成。  

“Content-Type”定义了紧随首部信息的数据类型。 以IP首部为例， 它就相当于协议字段。  

![](./img/mime.png)

![](./img/mime2.png)

## SMTP  

SMTP是发送电子邮件的协议。 它使用的是TCP的25号端口。 SMTP建立一个TCP连接以后， 在这个连接上进行控制和应答以及数据的发送。 客户端以文本的形式发出请求， 服务端返回一个3位数字的应答。每个指令和应答的最后都必须追加换行指令（CR、 LF） 。 

SMTP 命令：

![](./img/smtp_command.png) 

![](./img/smtp.png)

SMTP应答：

![](./img/smtp_response.png)  

## POP  

![](./img/pop.png)

SMTP的一个不利之处就在于它支持的是发送端主机的行为， 而不是根据接收端的请求发送邮件。为了解决这个问题， 就引入了POP协议。   

![](./img/pop_working.png)

POP与SMTP一样， 也是在其客户端与服务器之间通过建立一个TCP连接完成相应操作。  

POP主要命令：

![](./img/pop_command.png)

![](./img/pop_command2.png)

## IMAP  

IMAP（Internet Message Access Protocol） 与POP类似， 也是接收电子邮件的协议。 在POP中邮件由客户端进行管理， 而在IMAP中邮件则由服务器进行管理。  

使用IMAP时， 可以不必从服务器上下载所有的邮件也可以阅读。使用IMAP， 在服务器上保存和管理邮件信息， 就如同在自己本地客户端的某个闪存中管理自己的信息一样简单。     

有了IMAP人们就可以通过个人电脑、 公司的电脑、 笔记本电脑以及智能手机等连接到IMAP服务器以后进行收发邮件。   

# WWW  

万维网（WWW， World Wide Web） 是将互联网中的信息以超文本（超文本用以显示文本及与文本相关的内容。 ） 形式展现的系统。 也叫做Web。   

借助浏览器， 人们不需要考虑该信息保存在哪个服务器， 只需要轻轻点击鼠标就可以访问页面上的链接并打开相关信息。  

![](./img/www.png)

WWW定义了3个重要的概念， 它们分别是访问信息的手段与位置（URI， Uniform Resource Identifier） 、 信息的表现形式（HTML， HyperText Markup Language） 以及信息转发（HTTP， HyperText Transfer Protocol） 等操作。   

## URI  

URI是 Uniform Resource Identifier的缩写， 用于标识资源。 URI是一种可以用于WWW之外的高效的识别码， 它被用于主页地址、 电子邮件、 电话号码等各种组合中。   

URL（ Uniform Resource Locator）常被人们用来表示互联网中资源（ 文件） 的具体位置。 但是URI不局限于标识互联网资源， 它可以作为所有资源的识别码。      

相比URL狭义的概念， URI则是一个广义的概念。 因此， URI可以用于除了WWW之外的其他应用协议中。  

URI所表示的组合叫方案（ Scheme） （schema是指具有体系的计划或方案。 ） 。 在众多URI的Scheme中WWW主要用其中的http和https表示Web页的位置和访问Web页的方法。   

主要的URI方案：

![](./img/uri_scheme.png)  

## HTML  

HTMP是记述Web页的一种语言（数据格式） 。 它可以指定浏览器中显示的文字、 文字的大小和颜色。此外， 不仅可以对图像或动画进行相关设置， 还可以设置音频内容。  

HTML也可以说是WWW通用的数据表现协议。 即使是在异构的计算机上， 只要是可以用HTML展现的数据， 那么效果基本上是一致的。   

## HTTP  

HTTP中默认使用80端口。 它的工作机制， 首先是客户端向服务器的80端口建立一个TCP连接， 然后在这个TCP连接上进行请求和应答以及数据报文的发送。  

![](./img/http_working.png)

HTTP中常用的有两个版本， 一个HTTP1.0， 另一个是HTTP1.1。 在HTTP1.0中每一个命令和应答都会触发一次TCP连接的建立和断开。 而从HTTP1.1开始， 允许在一个TCP连接上发送多个命令和应答（这种方式也叫保持连接（keep-alive） 。 ） 。 由此， 大量地减少了TCP连接的建立和断开操作， 从而也提高了效率。  

### HTTP的主要命令以及应答报文  

HTTP的主要命令：

![](./img/http_command.png)

HTTP应答报文：

![](./img/http_response.png)  

## JavaScript、 CGI、 Cookie  

### JavaScript  

JavaScript是一种嵌入在HTML中的编程语言， 作为客户端程序可以运行于多种类型的浏览器中。 这些浏览器将嵌入JavaScript的HTML下载后， 其对应的JavaScript程序就可以在客户端得到执行。  

JavaScript还可以用于操作HTML或XML的逻辑结构（DOM， Document Object Model） 以及动态显示Web页的内容和页面风格上。  

![](./img/javascript_cgi.png)

### CGI  





















  