# 数据链路的作用  

数据链路， 指OSI参考模型中的数据链路层， 有时也指以太网、 无线局域网等通信手段。  

TCP/IP中对于OSI参考模型的数据链路层及以下部分（物理层） 未作定义。 因为TCP/IP以这两层的功能是透明的为前提。   

数据链路层的协议定义了通过通信媒介互连的设备之间传输的规范。 通信媒介包括双绞线电缆、 同轴电缆、 光纤、 电波以及红外线等介质。 此外， 各个设备之间有时也会通过交换机、 网桥、 中继器等中转数据。  

## 数据链路的段  

数据链路的段是指一个被分割的网络。 然而根据使用者不同， 其含义也不尽相同。   

例如， 引入中继器将两条网线相连组成一个网络。这种情况下有两条数据链路：    

- 从网络层的概念看， 它是一个网络（逻辑上），即从网络层的立场出发， 这两条网线组成一个段
- 从物理层的概念看， 两条网线分别是两个物体（物理上），即从物理层的观点出发， 一条网线是一个段  

![](./img/segment.png)

## 网络拓扑  

网络的连接和构成的形态称为网络拓扑（Topology） 。 网络拓扑包括总线型、 环型、 星型、 网状型等。   

![](./img/topology.png)

# 数据链路相关技术  

## MAC地址  

MAC地址用于识别数据链路中互连的节点，以太网或FDDI中， 根据IEEE802.3的规范使用MAC地址。 其他诸如无线LAN（IEEE802.11a/b/g/n等） 、 蓝牙等设备中也是用相同规格的MAC地址。    

![](./img/mac_dest.png)

MAC地址长48比特， 结构如图所示：

 ![](./img/mac_address.png)

IEEE802.3制定MAC地址规范时没有限定数据链路的类型， 即不论哪种数据链路的网络（以太网、FDDI、 ATM、 无线LAN、 蓝牙等） ， 都不会有相同的MAC地址出现。  

### 例外情况——MAC地址不一定是唯一的  

在全世界， MAC地址也并不总是唯一的。 实际上， 即使MAC地址相同， 只要不是同属一个数据链路就不会出现问题。例如， 人们可以在微机板上自由设置自己的MAC地址。 再例如， 一台主机上如果启动多个虚拟机，由于没有硬件的网卡只能由虚拟软件自己设定MAC地址给多个虚拟网卡， 这时就很难保证所生成的MAC地址是独一无二的了。    

但是， 无论哪个协议成员通信设备， 设计前提都是MAC地址的唯一性。 这也可以说是网络世界的基本准则。  

## 共享介质型网络  

从通信介质（通信， 介质） 的使用方法上看， 网络可分为共享介质型和非共享介质型。  

共享介质型网络指由多个设备共享一个通信介质的一种网络。 最早的以太网和 FDDI 就是介质共享型网络。 在这种方式下， 设备之间使用同一个载波信道进行发送和接收。 为此， 基本上采用半双工通信方式， 并有必要对介质进行访问控制。   

共享介质型网络中有两种介质访问控制方式： 

- 一种是争用方式
- 另一种是令牌传递方式  

###　争用方式  

争用方式（Contention） 是指争夺获取数据传输的权力， 也叫CSMA（载波监听多路访问） 。   这种方法通常令网络中的各个站采用先到先得的方式占用信道发送数据， 如果多个站同时发送帧， 则会产生冲突现象。 也因此会导致网络拥堵与性能下降。   

![](./img/contention.png)

在一部分以太网当中， 采用了改良CSMA的另一种方式——CSMA/CD（Carrier Sense Multiple Access with Collision Detection） 方式。 CSMA/CD要求每个站提前检查冲突， 一旦发生冲突， 则尽早释放信道。 其具体工作原理如下：  

- 如果载波信道上没有数据流动， 则任何站都可以发送数据  
- 检查是否会发生冲突。 一旦发生冲突时， 放弃发送数据， 同时立即释放载波信道
- 放弃发送以后， 随机延时一段时间， 再重新争用介质， 重新发送帧

CSMA/CD具体工作原理：

![](./img/csma_cd.png)

### 令牌传递方式  

令牌传递方式是沿着令牌环发送一种叫做“令牌”的特殊报文， 是控制传输的一种方式。 只有获得令牌的站才能发送数据。 这种方式有两个特点： 

- 一是不会有冲突
- 二是每个站都有通过平等循环获得令牌的机会。因此， 即使网络拥堵也不会导致性能下降  

这种方式中， 一个站在没有收到令牌前不能发送数据帧， 因此在网络不太拥堵的情况下数据链路的利用率也就达不到100％。 为此， 衍生了多种令牌传递的技术。 例如， 早期令牌释放、 令牌追加等方式以及多个令牌同时循环等方式。 这些方式的目的都是为了尽可能地提高网络性能。   

![](./img/token_passing.png)

## 非共享介质网络  

非共享介质网络是指不共享介质， 是对介质采取专用的一种传输控制方式：

-  在这种方式下， 网络中的每个站直连交换机， 由交换机负责转发数据帧
- 此方式下， 发送端与接收端并不共享通信介质， 因此很多情况下采用全双工通信方式  

该方式还可以根据交换机的高级特性构建虚拟局域网（VLAN， Virtual LAN）、 进行流量控制等。 当然， 这种方式也有一个致命的弱点， 那就是一旦交换机发生故障，与之相连的所有计算机之间都将无法通信。  

![](./img/unshared_media.png)

### 半双工与全双工通信  

半双工是指， 只发送或只接收的通信方式。 它类似于无线电收发器， 若两端同时说话， 是听不见对方说的话的。 

而全双工不同， 它允许在同一时间既可以发送数据也可以接收数据。 类似于电话， 接打双方可以同时说话。  

## 根据MAC地址转发  

若将集线器或集中器等设备以星型连接， 就出现了一款新的网络设备——交换集线器， 这是一种将非介质共享型网络中所使用的交换机用在以太网中的技术，交换集线器也叫做以太网交换机。  

以太网交换机就是持有多个端口的网桥。 它们根据数据链路层中每个帧的目标MAC地址， 决定从哪个网络接口发送数据。 这时所参考的、 用以记录发送接口的表就叫做转发表（Forwarding Table） 。  

这种转发表的内容不需要使用者在每个终端或交换机上手工设置， 而是可以自动生成。 数据链路层的每个通过点在接到包时， 会从中将源MAC地址以及曾经接收该地址发送的数据包的接口作为对应关系记录到转发表中。这一过程也叫自学过程。  

 ![](./img/switch_self_study.png) 

当设备数量增加时， 转发表也会随之变大， 检索转发表所用的时间也就越来越长。 当连接多个终端时， 有必要将网络分成多个数据链路， 采用类似于网络层的IP地址一样对地址进行分层管理。  

### 交换机转发方式  

交换机转发方式有两种：

- 一种叫存储转发：存储转发方式检查以太网数据帧末尾的FCS位后再进行转发。 因此， 可以避免发送由于冲突而被破坏的帧或噪声导致的错误帧  
- 另一种叫直通转发：不需要将整个帧全部接收下来以后再进行转发。 只需要得知目标地址即可开始转发。 因此， 它具有延迟较短的优势。 但同时也不可避免地有发送错误帧的可能性  





