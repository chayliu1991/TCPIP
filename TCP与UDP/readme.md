# 传输层的作用  

TCP/IP中有两个具有代表性的传输层协议， 它们分别是TCP和UDP。 TCP提供可靠的通信传输， 而UDP则常被用于让广播和细节控制交给应用的通信传输。   

## 传输层定义  

传输层的TCP和UDP， 为了识别自己所传输的数据部分究竟应该发给哪个应用， 也设定了这样一个编号。  根据端口号就可以识别在传输层上一层的应用层中所要进行处理的具体程序（一个程序可以使用多个端口。 ） 。  

## 通信处理  

![](./img/http_query.png)

传输协议TCP、 UDP通过接收数据中的目标端口号识别目标处理程序。   

## 两种传输层协议TCP和UDP  

### TCP  

TCP是面向连接的、 可靠的流协议。 流就是指不间断的数据结构，当应用程序采用TCP发送消息时， 虽然可以保证发送的顺序， 但还是犹如没有任何间隔的数据流发送给接收端。

TCP为提供可靠性传输， 实行“顺序控制”或“重发控制”机制。 此外还具备“流控制（流量控制） ”、 “拥塞控制”、 提高网络利用率等众多功能。       

### UDP  

UDP是不具有可靠性的数据报协议。 细微的处理它会交给上层的应用去完成。 在UDP的情况下， 虽然可以确保发送消息的大小， 却不能保证消息一定会到达。 因此， 应用有时会根据自己的需要进行重发处理。    

##　TCP与UDP区分  

TCP用于在传输层有必要实现可靠传输的情况。 由于它是面向有连接并具备顺序控制、 重发控制等机制的， 所以它可以为应用提供可靠传输。  

UDP主要用于那些对高速传输和实时性有较高要求的通信或广播通信。   

因此， TCP和UDP应该根据应用的目的按需使用。  

# 端口号  

## 端口号定义  

数据链路和IP中的地址， 分别指的是MAC地址和IP地址。 前者用来识别同一链路中不同的计算机， 后者用来识别TCP/IP网络中互连的主机和路由器。 在传输层中也有这种类似于地址的概念， 那就是端口号。 端口号用来识别同一台计算机中进行通信的不同应用程序。 因此， 它也被称为程序地址。  

## 根据端口号识别应用  

![](./img/Port_app.png)

传输层协议正是利用这些端口号识别本机中正在进行通信的应用程序， 并准确地将数据传输。  

## 通过IP地址、 端口号、 协议号进行通信识别  

![](./img/multi_query.png)

仅凭目标端口识别某一个通信是远远不够的。  

①和②的通信是在两台计算机上进行的。 它们的目标端口号相同， 都是80。   在这种情况下也必须严格区分这两个通信。 因此可以根据源端口号加以区分。  

③跟①的目标端口号和源端口号完全相同， 但是它们各自的源IP地址不同。   

此外， 还有一种情况上图中并未列出， 那就是IP地址和端口全都一样， 只是协议号（表示上层是TCP或UDP的一种编号） 不同。这种情况下， 也会认为是两个不同的通信。  

因此， TCP/IP或UDP/IP通信中通常采用5个信息来识别一个通信。 它们是“源IP地址”、 “目标IP地址”、 “协议号”、 “源端口号”、 “目标端口号”。 只要其中某一项不同， 则被认为是其他通信。    

## 端口号如何确定  

在实际进行通信时， 要事先确定端口号。 确定端口号的方法分为两种：  

### 标准既定的端口号  

这种方法也叫静态方法。 它是指每个应用程序都有其指定的端口号。 但并不是说可以随意使用任何一个端口号。 每个端口号都有其对应的使用目的。

例如， HTTP、 TELNET、 FTP等广为使用的应用协议中所使用的端口号就是固定的。 这些端口号也被称之为知名端口号（Well-Known Port Number） 。   

除知名端口号之外， 还有一些端口号也被正式注册。 它们分布在1024到49151的数字之间。 不过， 这些端口号可用于任何通信用途。   

### 时序分配法  

第二种方法也叫时序（或动态的） 分配法。 此时， 服务端有必要确定监听端口号， 但是接受服务的客户端没必要确定端口号。  

动态分配的端口号取值范围在49152到65535之间。  

## 端口号与协议  

端口号由其使用的传输层协议决定。 因此， 不同的传输协议可以使用相同的端口号。 例如， TCP与UDP使用同一个端口号， 但使用目的各不相同。 这是因为端口号上的处理是根据每个传输协议的不同而进行的。  

数据到达IP层后， 会先检查IP首部中的协议号， 再传给相应协议的模块。 如果是TCP则传给TCP模块、如果是UDP则传给UDP模块去做端口号的处理。 即使是同一个端口号， 由于传输协议是各自独立地进行处理， 因此相互之间不会受到影响。  

此外， 那些知名端口号与传输层协议并无关系， 只要端口一致都将分配同一种程序进行处理。例如， 53号端口在TCP与UDP中都用于DNS服务， 而80端口用于HTTP通信。 从目前来看， 由于HTTP通信必须使用TCP， 因此UDP的80端口并未投入使用。 但是将来， 如果HTTP协议的实现也开始应对UDP协议以及应用协议被相应扩展的情况下， 就可以原样使用与TCP保持相同的80端口号了。     

TCP具有代表性的知名端口号：

![](./img/tcp_port.png)

UDP具有代表性的知名端口号：

![](./img/udp_port.png)

# UDP

UDP是User Datagram Protocol的缩写。

UDP不提供复杂的控制机制， 利用IP提供面向无连接的通信服务。 并且它是将应用程序发来的数据在收到的那一刻， 立即按照原样发送到网络上的一种机制。  

即使是出现网络拥堵的情况下， UDP也无法进行流量控制等避免网络拥塞的行为。 此外， 传输途中即使出现丢包， UDP也不负责重发。 甚至当出现包的到达顺序乱掉时也没有纠正的功能。 如果需要这些细节控制， 那么不得不交由采用UDP的应用程序去处理。

由于UDP面向无连接， 它可以随时发送数据。 再加上UDP本身的处理既简单又高效， 因此经常用于以下几个方面：  

- 包总量较少的通信（DNS、 SNMP等）
- 视频、 音频等多媒体通信（即时通信）
- 限定于LAN等特定网络中的应用通信
- 广播通信（广播、 多播）  

# TCP  











