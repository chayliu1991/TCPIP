# 路由控制的定义  

## IP地址与路由控制  

互联网是由路由器连接的网络组合而成的。 为了能让数据包正确达地到达目标主机， 路由器必须在途中进行正确地转发。 这种向“正确的方向”转发数据所进行的处理就叫做路由控制或路由。  

路由器根据路由控制表（Routing Table） 转发数据包。 它根据所收到的数据包中目标主机的IP地址与路由控制表的比较得出下一个应该接收的路由器。 因此， 这个过程中路由控制表的记录一定要正确无误。 但凡出现错误， 数据包就有可能无法到达目标主机。  

## 静态路由与动态路由  

路由控制分静态（Static Routring） 和动态（Dynamic Routing） 两种类型。静态路由是指事先设置好路由器和主机中并将路由信息固定的一种方法。 而动态路由是指让路由协议在运行过程中自动地设置路由控制信息的一种方法。 这些方法都有它们各自的利弊。  

![](./img/static_dynamic_routing.png)

静态路由给管理者带来很大的负担， 这是其一。 还有一个不可忽视的问题是， 一旦某个路由器发生故障， 基本上无法自动绕过发生故障的节点， 只有在管理员手工设置以后才能恢复正常。  

使用动态路由的情况下， 管理员必须设置好路由协议， 其设定过程的复杂程度与具体要设置路由协议的类型有直接关系。 如果有一个新的网络被追加到原有的网络中时， 只要在新增加网络的路由器上进行一个动态路由的设置即可。网络上一旦发生故障， 只要有一个可绕的其他路径， 那么数据包就会自动选择这个路径， 路由器的设置也会自动重置。       

不论是静态路由还是动态路由， 不要只使用其中一种， 可以将它们组合起来使用。  

## 动态路由的基础  

动态路由会给相邻路由器发送自己已知的网络连接信息， 而这些信息又像接力一样依次传递给其他路由器， 直至整个网络都了解时， 路由控制表也就制作完成了。 而此时也就可以正确转发IP数据包了。

![](./img/dynamic_routing.png)    

# 路由控制范围  

根据路由控制的范围常使用IGP（Interior Gateway Protocol） 和EGP（Exterior Gateway Protocol）两种类型的路由协议。  

## 自治系统与路由协议  

制定自己的路由策略， 并以此为准在一个或多个网络群体中采用的小型单位叫做自治系统（AS：Autonomous System） 或路由选择域（Routing Domain） 。  

![](./img/egp_igp.png)

自治系统（路由选择域） 内部动态路由采用的协议是域内路由协议， 即IGP。 而自治系统之间的路由控制采用的是域间路由协议， 即EGP。  

 ## IGP与EGP  

P地址分为网络部分和主机部分， 它们有各自的分功。 EGP与IGP的关系与IP地址网络部分和主机部分的关系有相似之处。 就像根据IP地址中的网络部分在网络之间进行路由选择、 根据主机部分在链路内部进行主机识别一样， 可以根据EGP在区域网络之间（或ISP之间） 进行路由选择， 也可以根据IGP在区域网络内部（或ISP内部） 进行主机识别。由此， 路由协议被分为EGP和IGP两个层次。 没有EGP就不可能有世界上各个不同组织机构之间的通信。 没有IGP机构内部也就不可能进行通信。    

IGP中还可以使用RIP（Routing Information Protocol， 路由信息协议） 、 RIP2、 OSPF（Open Shortest Path First， 开放式最短路径优先） 等众多协议。 与之相对， EGP使用的是BGP（Border Gateway Protocol， 边界网关协议） 协议。  

# 路由算法  

路由控制有各种各样的算法， 其中最具代表性的有两种， 是距离向量（Distance-Vector） 算法和链路状态（Link-State） 算法。  

## 距离向量算法  

距离向量算法（DV） 是指根据距离和方向决定目标网络或目标主机位置的一种方法。    

![](./img/dv.png)

路由器之间可以互换目标网络的方向及其距离的相关信息， 并以这些信息为基础制作路由控制表。 这种方法在处理上比较简单， 不过由于只有距离和方向的信息， 所以当网络构造变得分外复杂时， 在获得稳定的路由信息之前需要消耗一定时间（也叫做路由收敛。 ） ， 也极易发生路由循环等问题。    

## 链路状态算法  

链路状态算法是路由器在了解网络整体连接状态的基础上生成路由控制表的一种方法。 该方法中， 每个路由器必须保持同样的信息才能进行正确的路由选择。  

对于任何一台路由器， 网络拓扑都完全一样。 因此， 只要某一台路由器与其他路由器保持同样的路由控制信息， 就意味着该路由器上的路由信息是正确的。 只要每个路由器尽快地与其他路由器同步路由信息， 就可以使路由信息达到一个稳定的状态。 因此， 即使网络结构变得复杂， 每个路由器也能够保持正确的路由信息、 进行稳定的路由选择。 这也是该算法的一个优点。   

为了实现上述机制， 链路状态算法付出的代价就是如何从网络代理获取路由信息表。 这一过程相当复杂， 特别是在一个规模巨大而又复杂的网络结构中， 管理和处理代理信息需要高速CPU处理能力和大量的内存。  

![](./img/link_state.png)

## 主要路由协议  

![](./img/routing_protocol.png)



